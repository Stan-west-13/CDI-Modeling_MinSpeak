---
title: "Standardized Network Analysis"
author: "Stanley West"
format: 
  revealjs:
    scrollable: true
    smaller: true
    fig-width: 24
    fig-height: 12
    fig-align: center
    
    
editor: 
  markdown: 
    wrap: 72
---

# The Data {.smaller .scrollable}

-   Up to this point, individual lexical networks have been constructed
    for each child, with edges drawn according to forward association
    (i.e., cue -\> response) relationships via child-oriented word
    association norms ([Cox & Haebig,
    2023](https://link.springer.com/content/pdf/10.3758/s13428-022-01790-y.pdf))
    -   Network statistics including in-degree (number of incoming
        connections), global clustering coefficient (ratio of number of
        triangles to the number of possible triangles), mean average
        shortest path length (ASPL, average edge distance between nodes)
        were computed for each child.
-   These values were standardized according to 1,000 individualized
    pseudo-random acquisition networks for each child where the number
    of nodes as well as the number of nouns, verbs, and other words were
    matched to the child's vocabulary.

```{r,echo = FALSE}
library(tidyverse)
library(ggplot2)
library(purrr)
library(MatchIt)
library(ggh4x)
library(plotly)
library(ggraph)
d_netstats <- read_rds("data/all_Netstats_z_meta.rds") %>%
  mutate(metric_plot = factor(metric, 
                              levels = c("indegreemed","indegreeavg","clustcoef","meandist"),
                              labels = c("Median_Indegree", "Average_Indegree","Clustering_Coefficient","Mean Distance")),
         group = factor(group, levels = c("yng", "mdl", "old")),
         netBuild = "associations")

d_netstats_nouns <- read_rds("data/all_Netstats_z_meta_nouns.rds")%>%
  mutate(metric_plot = factor(metric, 
                              levels = c("indegreemed","indegreeavg","clustcoef","meandist"),
                              labels = c("Median_Indegree", "Average_Indegree","Clustering_Coefficient","Mean Distance")),
         group = factor(group, levels = c("yng", "mdl", "old")),
         netBuild = "nounFeats")
d_netstats <- rbind(d_netstats,d_netstats_nouns)
matched_pps <- read_rds("data/matched_groups_single_timepoint.rds")

load("data/graph_full_nounNet.Rdata")
load("data/child_oriented_graph.Rdata")

```

## Overall Statistic Trajectories Over Vocabulary Size and Age {.smaller .scrollable}

```{r}

ggplot(d_netstats %>% 
         filter(origin == "truenet"&stat == "truestat"), aes(x = nProduced, y = value))+
  geom_point()+
  geom_smooth(method = "loess")+
  facet_grid2(netBuild~metric_plot,scales = "free", independent = "all")+
  theme_bw(base_size = 24)+
  labs(title = "True Scores Across Vocabuary")
ggplot(d_netstats %>% 
         filter(origin == "RAN"&stat == "mean"), aes(x = nProduced, y = value))+
  geom_point()+
  geom_smooth(method = "loess")+
  facet_grid2(netBuild~metric_plot,scales = "free", independent = "all")+
  theme_bw(base_size = 24)+
  labs(title = "RAN Scores Across Vocabuary")

ggplot(d_netstats, aes(x = nProduced, y = z))+
  geom_point()+
  geom_smooth(method = "loess")+
  facet_grid2(netBuild~metric_plot,scales = "free",independent = "all")+
  theme_bw(base_size = 24)+
  labs(title = "Standardized Scores across vocabuary")
```

## Plotting unmatched statistic distributions over production {.smaller .scrollable}

-   Distributions across the unmatched samples look similar, especially
    at smaller vocabularies.
-   However, this is still collapsed across forms.

```{r}

ggplot(d_netstats %>% 
         filter(form == "WS"), aes(x = nProduced, y = z, color = group))+
  facet_grid(~metric_plot)+
  geom_smooth(method = "lm",
              formula = y~poly(x,3))+
  theme_bw(base_size = 24)+
  labs(title = "Unmatched Statistic Distrubution Over Production - Words & Sentences",
       x = "Productive Vocabulary",
       y = "Z-scored Network Statistic")

ggplot(d_netstats %>% 
         filter(form == "WG"), aes(x = nProduced, y = z, color = group))+
  geom_point() +
  facet_grid(~metric_plot)+
  geom_smooth(method = "lm",
              formula = y~poly(x,3))+
  theme_bw(base_size = 24)+
  labs(title = "Unmatched Statistic Distrubution Over Production - Words & Gestures",
       x = "Productive Vocabulary",
       y = "Z-scored Network Statistic")



ggplot(d_netstats , aes(x = group, y = z, color = group))+
  geom_violin() +
  geom_boxplot(width = 0.2, fill = "lightgrey")+
  facet_grid(~metric_plot)+
  theme_bw(base_size = 24)+
  labs(title = "Unmatched Statistic Boxplots Over Group ",
       x = "Group",
       y = "Z-scored Network Statistic")

```

-   The middle group does not have any child with production past 100
    for the words and gestures form, making it hard to compare to the
    other groups, so we removed this group and instead will look at
    minimally speaking vs. non-minimally speaking.

## First Administrations - Both Forms

-   Including both WS and WG, but only taking the first administration
    for a child results in 222 words and sentences and 48 words and
    gestures forms.

```{r}
d_netstats_first <- d_netstats %>%
  mutate(group_two = as.factor(ifelse(group == "yng"|group =="mdl", "non_minspeak","minspeak"))) %>%
  filter(origin == "truenet") %>%
  group_by(subjectkey) %>%
  slice_min(interview_age, n = 1 )

d_netstats_first %>%
  select(subjectkey,group_two,nProduced, interview_age) %>%
  unique() %>%
  group_by(group_two) %>%
  summarize(n = n(),
            mean_nProduced = mean(nProduced),
            sd_nProduced = sd(nProduced),
            mean_age = mean(interview_age),
            sd_age = sd(interview_age))




```

## Matching to the minimally speaking group.

```{r}
match_lst_all <- d_netstats_first %>%
  select(subjectkey_intAge, interview_age,nProduced, group_two) %>%
  unique() %>%
  matchit(group_two ~ nProduced, data = ., method = "optimal", distance = "glm",ratio = 3)

matched_df_all <- d_netstats_first %>%
  filter(subjectkey_intAge %in% match.data(match_lst_all)$subjectkey_intAge) %>%
  mutate(int_age_cut = cut(interview_age,3))

matched_df_all %>%
  select(subjectkey,nProduced,group_two) %>%
  unique() %>%
  t.test(nProduced~group_two, data = .)

```

-   Keeping both WS and WG forms, retains 17 in the old group, now will
    be able to match to $n = 48$ per group.

```{r, echo =  FALSE,fig.width=48, fig.height=12, fig.fullwidth=TRUE}

ggplot(matched_df_all, aes(x = nProduced, color = group_two))+
  geom_density(size = 2)+
  theme_bw(base_size = 52)

ggplot(matched_df_all, aes(x = nProduced, , y = interview_age,color = group_two))+
  geom_point(size = 13)+
  theme_bw(base_size = 52)


```

## Run Linear Models {.smaller .scrollable}

-   Linear models were run regressing
    $network_{statistic} \sim (linear_{nproduced} + quadratic_{nproduced} +cubic_{nproduced})  * group$

-   Number of words produced was re-factored to account for third-order
    polynomial trends in the network statistics

-   No models revealed any group differences in network structure nor
    interaction with interview age.

```{r}

nProduced_poly_all <- matched_df_all %>%
  ungroup() %>%
  select(nProduced) %>%
  unique() %>%
  cbind(poly(.$nProduced,3)) %>%
  rename(linear = "1",
         quadratic = "2",
         cubic = "3")

matched_df_poly_all <- matched_df_all %>%
  left_join(nProduced_poly_all) %>%
  filter(origin == "truenet")

d_splits_all <- split(matched_df_poly_all,matched_df_poly_all$metric)

x <- map(d_splits_all, function(x){
  lm(z ~ (linear+quadratic+cubic)*group_two, data = x)
})

lapply(x, summary)


```

## Plot the Trends

```{r}

ggplot(matched_df_poly_all %>% 
         filter(origin == "truenet"), aes(x = nProduced, y = z, color = group_two))+
  #geom_point()+
  theme_bw(base_size = 24) +
  geom_smooth(method = "lm",
              formula = y ~ poly(x,3))+
  facet_grid(~metric_plot)


```

# Words and Gestures Analyses Only

-   Youngest administration

-   Only allowing networks of size 3 - 349 words.

-   Collapsing the middle-aged group (48 - 70 months old) and the
    youngest group (16 - 42 months) to create a non-minimally speaking
    and a minimally speaking group.

## Filtering to Words and Gestures

```{r,echo = TRUE}
d_WG <- d_netstats %>%
  filter(form == "WG",
         nProduced >= 3 & nProduced <= 392) %>%
  group_by(subjectkey) %>%
  slice_min(interview_age,n = 1) %>%
  mutate(group_two = as.factor(ifelse(group == "yng"|group =="mdl", "non_minspeak","minspeak")))

d_WG %>%
  select(subjectkey,interview_age,nProduced,group_two) %>%
  unique() %>%
  group_by(group_two) %>%
  summarize(n = n(),
            mean_age = mean(interview_age),
            mean_produced = mean(nProduced),
            sd_age = sd(interview_age),
            sd_produced = sd(nProduced)) %>%
  as.data.frame()
  


```

## Match groups on vocabulary size {.scrollable .smaller}

-   Matching to the minimally speaking group yields $n = 32$ for each
    group, $t(61.993) = -0.039$, $p = 0.969$

```{r, echo =  FALSE,fig.fullwidth=TRUE,fig.width=24, fig.height=12}

match_lst <- d_WG %>%
  select(subjectkey_intAge, interview_age,nProduced, group_two) %>%
  unique() %>%
  matchit(group_two ~ nProduced, data = ., method = "optimal", distance = "glm", ratio = 2)

matched_df <- d_WG %>%
  filter(subjectkey_intAge %in% match.data(match_lst)$subjectkey_intAge)

matched_df %>%
  select(subjectkey,nProduced,group_two) %>%
  unique() %>%
  t.test(nProduced~group_two, data = .)





```

```{r, echo =  FALSE,fig.width=48, fig.height=12, fig.fullwidth=TRUE}

ggplot(matched_df, aes(x = nProduced, color = group_two))+
  geom_density(size = 2)+
  theme_bw(base_size = 52)

ggplot(matched_df, aes(x = nProduced, , y = interview_age,color = group_two))+
  geom_point(size = 13)+
  theme_bw(base_size = 52)




```

## Run Linear Models

-   Linear models were run regressing
    $network_{statistic} \sim (linear_{nproduced} + quadratic_{nproduced} +cubic_{nproduced}) * group$

-   Number of words produced was re-factored to account for third-order
    polynomial trends in the network statistics

    ```{r}

    nProduced_poly <- matched_df %>%
      ungroup() %>%
      select(nProduced) %>%
      unique() %>%
      cbind(poly(.$nProduced,3)) %>%
      rename(linear = "1",
             quadratic = "2",
             cubic = "3")

    matched_df_poly <- matched_df %>%
      left_join(nProduced_poly) %>%
      filter(origin == "truenet")

    d_splits <- split(matched_df_poly,matched_df_poly$metric)

    x <- map(d_splits, function(x){
      lm(z ~ (linear+quadratic+cubic) * group_two, data = x)
    })

    lapply(x, summary)


    ```

    ```{r}
    ggplot(matched_df %>% 
             filter(origin == "truenet"), aes(x = nProduced, y = z, color = group_two))+
      #geom_point()+
      theme_bw(base_size = 24) +
      geom_smooth(method = "lm",
                  formula = y ~ poly(x,3))+
      facet_wrap(~metric_plot)
    ```

# 
